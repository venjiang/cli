# https://taskfile.dev

version: '3'

vars:
  Name: yomo
  ExeName: yomo{{exeExt}}
  ExeDir: yomo 
  Version: 
    sh: git describe --always --tags --dirty
  Date:
    sh: git show -s --format=%cs {{.Commit}}
  Commit:
    sh: git rev-parse --short HEAD
  Module:
    sh: go list -m

tasks:
  default:
    cmds:
      - echo "{{.Name}}"
    silent: true

  build:
    desc: build yomo cli tools
    cmds:
      - echo "{{.Name}} building..."
      - go build -v -o {{.ExeDir}}/{{.ExeName}} -ldflags "-s -w -X {{.Module}}/cmd.Version={{.Version}} -X {{.Module}}/cmd.Date={{.Date}}" {{.ExeDir}}/main.go
      - echo "{{.Name}} built."
    generates:
      - "{{.ExeDir}}/{{.ExeName}}"
    sources:
      - "**/*.go"
    method: none
    silent: true

  run:
    desc: run yomo cli 
    deps: [build]
    cmds:
      - "{{.ExeDir}}/{{.ExeName}}"
    silent: false

  example-basic:
    desc: yomo run basic application
    deps: [build]
    cmds:
      - "{{.ExeDir}}/{{.ExeName}} run --name basic example/basic/main.go"
    silent: false

  example-app:
    desc: yomo run cli/app.go
    deps: [build]
    cmds:
      - "{{.ExeDir}}/{{.ExeName}} run -n Noise example/cli/app.go"
    silent: false

  example-flow:
    desc: "yomo run -n xxx example/flow/app.go"
    deps: [build]
    cmds:
      - "{{.ExeDir}}/{{.ExeName}} run -n Noise example/flow/app.go"
    silent: false

  example-zipper:
    desc: "yomo serve -c example/zipper/workflow.yaml"
    deps: [build]
    cmds:
      - "{{.ExeDir}}/{{.ExeName}} serve -c example/zipper/workflow.yaml"
    silent: false

  basic-run:
    desc: go run basic application
    cmds:
      - "go run example/basic/main.go"
    silent: false

  basic-build:
    desc: go build basic application
    dir: example/basic/
    cmds:
      - go build -v -o basic{{.exeExt}} -ldflags "-s -w" main.go
    silent: false

  version:
    desc: "print version"
    cmds: 
      - echo "Version {{.Version}}({{.Date}})"
    vars:
    silent: true
