
// Serverless main function
func main() {
	sfn := yomo.NewStreamFunction(
		"{{.Name}}",
		yomo.WithZipperAddr("{{.Host}}:{{.Port}}"),
		yomo.WithObserveDataTags(DataTags()...),
        {{if .Credential -}}yomo.WithCredential("{{.Credential}}"),{{- end}}
	)
	defer sfn.Close()

	// create a Rx runtime.
	rt := rx.NewRuntime(sfn)

	// set handler
	sfn.SetHandler(rt.RawByteHandler)

	// set error handler
	sfn.SetErrorHandler(func(err error) {
		log.Printf("[flow] error handler: %v", err)
	})

	// start
	err := sfn.Connect()
	if err != nil {
		log.Printf("[flow] connect err=%v", err)
	}

	// pipe rx stream and rx handler.
	rt.Pipe(Handler)

	select {}
}
